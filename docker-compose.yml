# Definimos los servicios que componen la aplicación.
services:
  # Servicio principal de la aplicación web con Apache y PHP
  app:
    # Construimos la imagen usando el Dockerfile en la raíz del proyecto.
    build:
      context: .
      dockerfile: Dockerfile
    # Le asignamos una etiqueta a la imagen para poder reutilizarla en otros servicios.
    image: manager:latest
    container_name: manager_app
    ports:
      - "80:80"    # Mapea el puerto 80 del contenedor al 80 del host.
    env_file:
      - .env.docker

  # Servicio auxiliar para ejecutar tareas de línea de comandos (migraciones, seeds, jobs, etc.)
  cli:
    # Reutiliza exactamente la misma imagen que el servicio app.
    image: manager:latest
    working_dir: /var/www/html
    # Establece bash como entrypoint para poder ejecutar comandos arbitrarios.
    entrypoint: ["/bin/bash", "-lc"]
    env_file:
      - .env.docker
